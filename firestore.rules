/**
 * @file firestore.rules
 * @description Firestore Security Rules for an educational content platform.
 *
 * @section Core Philosophy
 * This ruleset establishes a "Public Read, User-Specific Write" security model.
 * Educational content is public, while user profiles can only be created by their respective owners.
 * Admin users have full access to content management.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to user profile documents.
     * @allow Any user can create their own user document.
     * @allow A logged-in user can read or update their own document.
     */
    match /users/{userId} {
      allow create: if true;
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow delete: if false; // Generally, users shouldn't delete their own accounts from the client.
    }

    /**
     * @description Controls access to the 'resources' collection.
     * @allow Any user can read resources.
     * @allow Admin users can create, update, and delete resources.
     */
    match /resources/{resourceId} {
        allow read: if true;
        allow write: if request.auth != null && request.auth.token.email == 'quizpankaj@gmail.com';
    }


    /**
     * @description Controls access to the top-level 'classes' collection.
     * @path /classes/{classId}
     * @allow Any user can read classes. Writes are disallowed.
     */
    match /classes/{classId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to the 'subjects' subcollection.
     * @path /classes/{classId}/subjects/{subjectId}
     * @allow Any user can read subjects. Writes are disallowed.
     */
    match /classes/{classId}/subjects/{subjectId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to the 'lessons' subcollection.
     * @path /classes/{classId}/subjects/{subjectId}/lessons/{lessonId}
     * @allow Any user can read lessons. Writes are disallowed.
     */
    match /classes/{classId}/subjects/{subjectId}/lessons/{lessonId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Controls access to the 'contents' subcollection.
     * @path /classes/{classId}/subjects/{subjectId}/lessons/{lessonId}/contents/{contentId}
     * @allow Any user can read content. Writes are disallowed.
     */
    match /classes/{classId}/subjects/{subjectId}/lessons/{lessonId}/contents/{contentId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }
  }
}

    